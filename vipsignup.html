<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VIP Premium Signup</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: radial-gradient(circle at top, #1a1a1a, #000);
    font-family: 'Segoe UI', Tahoma, sans-serif;
    color: white;
    min-height: 100vh; display: flex; justify-content: center; align-items: center;
    padding: 1rem;
  }
  .vip-card {
    background: linear-gradient(135deg, #1e1e1e, #000);
    border: 2px solid #ff007a88;
    border-radius: 20px;
    padding: 2.5rem;
    max-width: 460px; width: 100%;
    box-shadow: 0 0 40px #ff00cc88, inset 0 0 10px #ff00cc44;
    text-align: center;
  }
  .vip-card h2 {
    font-size: 2.2rem;
    background: linear-gradient(to right, #ff00cc, #ff77ff);
    -webkit-background-clip: text;
    color: transparent;
    margin-bottom: 1.5rem;
  }
  form { display: flex; flex-direction: column; gap: 1rem; text-align: left; }
  label { font-weight: 600; color: #ff77ffcc; }
  input {
    padding: 0.8rem 1rem; font-size: 1rem;
    border-radius: 10px; border: 2px solid #333;
    background: #222; color: white;
    transition: border-color 0.3s ease; caret-color: #ff00cc;
  }
  input:focus { border-color: #ff00cc; box-shadow: 0 0 10px #ff00cc88; outline: none; }
  .error-msg { color: #ff4d4f; font-size: 0.85rem; min-height: 1.2rem;}
  button {
    margin-top: 1rem; padding: 0.85rem; font-size: 1.15rem; font-weight: 700;
    border-radius: 30px; border: none;
    background: linear-gradient(90deg, #ff00cc, #ff007a); color: white;
    cursor: pointer; box-shadow: 0 0 15px #ff00ccaa;
    transition: 0.3s ease;
  }
  button:disabled { background: #330033; color: #880088; box-shadow: none; cursor: not-allowed; }
  button:not(:disabled):hover { background: linear-gradient(90deg, #ff33ee, #ff3399); transform: scale(1.05); }
  .vip-note { margin-top: 1.2rem; font-size: 0.9rem; color: #aaa; text-align: center; }
  .vip-note a { color: #ff00cc; font-weight: 600; text-decoration: none; }
  .form-status {
    margin-top: 1rem; font-size: 1rem; font-weight: 600;
    min-height: 1.3rem; text-align: center;
  }
  .form-status.success { color: #4caf50; }
  .form-status.error { color: #ff4d4f; }
  /* extras preserved */
  .copy-btn { 
    background: linear-gradient(90deg,#ff00cc,#3333ff);
    color: #fff; font-weight: 600;
    border: none; border-radius: 12px;
    padding: 0.25rem 1.1rem; cursor: pointer;
    transition: .18s; margin-left: 0.3rem;
    box-shadow: 0 0 6px #ff00cc44;
    font-size: 0.98rem;
    min-width: 68px;
  }
  .copy-btn:active { background: #232345; }
  .copy-btn:hover { background: #ff00cc; }
</style>
</head>
<body>

<div class="vip-card">
  <h2>âœ¨ VIP Signup</h2>

  <form id="signup-form" novalidate>
    <label for="vip-name">Full Name</label>
    <input type="text" id="vip-name" placeholder="Enter your full name" required autocomplete="name" />
    <div id="name-error" class="error-msg"></div>

    <label for="vip-email">Email</label>
    <input type="email" id="vip-email" placeholder="Enter your email" required autocomplete="username" />
    <div id="email-error" class="error-msg"></div>

    <label for="vip-password">Create Password</label>
    <input type="password" id="vip-password" placeholder="Create a password (min 6 chars)" minlength="6" required autocomplete="new-password" />
    <div id="password-error" class="error-msg"></div>

    <label for="vip-confirm">Confirm Password</label>
    <input type="password" id="vip-confirm" placeholder="Re-enter password" minlength="6" required autocomplete="new-password" />
    <div id="confirm-error" class="error-msg"></div>

    <button type="submit" disabled>Sign Up</button>
  </form>

  <div class="form-status" id="form-status"></div>

  <div class="vip-note">
    Already VIP? <a href="viplogin.html">Login here</a>
  </div>
</div>

<!-- Firebase SDKs (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ---------- Firebase config ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyA7oSJNvZxv2aBYNUGfj4UWJdm6yIoUwC8",
  authDomain: "vip-membership-b131a.firebaseapp.com",
  projectId: "vip-membership-b131a",
  storageBucket: "vip-membership-b131a.appspot.com",
  messagingSenderId: "1086103978236",
  appId: "1:1086103978236:web:b106e8d9afdc3d36925779"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ---------- Elements ---------- */
const form = document.getElementById('signup-form');
const nameInput = document.getElementById('vip-name');
const emailInput = document.getElementById('vip-email');
const passwordInput = document.getElementById('vip-password');
const confirmInput = document.getElementById('vip-confirm');
const submitBtn = form.querySelector('button');
const statusMsg = document.getElementById('form-status');

const nameError = document.getElementById('name-error');
const emailError = document.getElementById('email-error');
const passwordError = document.getElementById('password-error');
const confirmError = document.getElementById('confirm-error');

const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

/* ---------- Validation ---------- */
function validateName() {
  if (!nameInput.value.trim()) { nameError.textContent = "Name is required"; return false; }
  nameError.textContent = "";
  return true;
}
function validateEmail() {
  const e = emailInput.value.trim();
  if (!e) { emailError.textContent = "Email required"; return false; }
  if (!emailRegex.test(e)) { emailError.textContent = "Invalid email"; return false; }
  emailError.textContent = "";
  return true;
}
function validatePassword() {
  if (!passwordInput.value) { passwordError.textContent = "Password required"; return false; }
  if (passwordInput.value.length < 6) { passwordError.textContent = "Minimum 6 characters"; return false; }
  passwordError.textContent = "";
  return true;
}
function validateConfirm() {
  if (confirmInput.value !== passwordInput.value) { confirmError.textContent = "Passwords do not match"; return false; }
  confirmError.textContent = "";
  return true;
}

function checkForm() {
  // use & so all validators run (keeps inline error messages updated)
  const baseValid = validateName() & validateEmail() & validatePassword() & validateConfirm();
  submitBtn.disabled = !baseValid;
  return !!baseValid;
}

[nameInput, emailInput, passwordInput, confirmInput].forEach(i => i.addEventListener('input', checkForm));

/* ---------- Form submit ---------- */
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (!checkForm()) return;

  submitBtn.disabled = true;
  statusMsg.textContent = "Creating account...";
  statusMsg.className = "form-status";

  const name = nameInput.value.trim();
  const email = emailInput.value.trim().toLowerCase();
  const password = passwordInput.value;

  let createdUser = null;
  try {
    // create firebase auth user
    const cred = await auth.createUserWithEmailAndPassword(email, password);
    createdUser = cred.user;

    // set display name
    await cred.user.updateProfile({ displayName: name });

    // write user doc into UNKNOWN collection (keeping your existing structure)
    await db.collection("UNKNOWN").doc(email).set({
      HI: name,
      EMAIL: email,
      subscriptionType: "Free",
      subscriptionExpiry: null,
      APP: "GG MOUSE PRO",
      PASSWORD: "",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    statusMsg.textContent = "Signed up successfully! Redirecting...";
    statusMsg.className = "form-status success";
    setTimeout(()=> window.location.href = "viphome.html", 1200);

  } catch (err) {
    console.error(err);
    // if user created in auth but firestore write failed, delete the auth user to avoid orphan account
    if (createdUser && createdUser.delete) {
      try { await createdUser.delete(); } catch (delErr) { console.warn('Failed to delete user after error', delErr); }
    }
    statusMsg.textContent = err.message || "Signup failed.";
    statusMsg.className = "form-status error";
    submitBtn.disabled = false;
  }
});
</script>
</body>
</html>
