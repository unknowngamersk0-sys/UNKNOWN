<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unknown Gamer - VIP Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;600&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
  :root{
    --pink: #ff00cc;
    --blue: #3333ff;
    --bg: #0e0e0e;
    --panel: #141418;
    --muted: #9aa0c7;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'Poppins',sans-serif;
    background:
      radial-gradient(1000px 400px at 10% 10%, rgba(51,51,255,0.06), transparent 10%),
      linear-gradient(180deg,#0b0b0b 0%, #0f0f12 100%);
    color:#fff;
    padding:32px;
  }

  .container{
    width:100%;
    max-width:880px;
    display:grid;
    grid-template-columns: 1fr 380px;
    gap:28px;
    align-items:start;
  }

  .left { display:flex; flex-direction:column; gap:18px; }

  .main-title{
    font-family:'Orbitron',sans-serif;
    font-size:34px;
    letter-spacing:1px;
    margin:0 0 4px 0;
    background:linear-gradient(90deg,var(--pink),var(--blue) 90%);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
  }
  .subtitle{ color:var(--muted); margin:0 0 16px 0; font-size:14px; }

  .vip-card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;
    padding:22px;
    border:1px solid rgba(255,0,204,0.09);
    box-shadow:0 6px 30px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
    gap:12px;
    transition:transform .25s ease, box-shadow .25s ease;
    position:relative;
    overflow:hidden;
  }
  .vip-card.active{
    transform:translateY(-6px);
    box-shadow: 0 8px 50px rgba(255,0,204,0.18), 0 0 80px rgba(51,51,255,0.08);
    border: 1px solid rgba(255,0,204,0.35);
    animation: soft-pulse 2.6s infinite;
  }
  @keyframes soft-pulse{
    0%{ box-shadow: 0 8px 40px rgba(255,0,204,0.12); }
    50%{ box-shadow: 0 12px 70px rgba(255,0,204,0.18); }
    100%{ box-shadow: 0 8px 40px rgba(255,0,204,0.12); }
  }

  .card-row{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .info-line{ font-weight:700; font-size:15px; color:#e8e6ff; }
  .muted-small{ color:var(--muted); font-weight:500; font-size:13px }

  .vip-meta{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .pill{
    background:linear-gradient(90deg, rgba(255,0,204,0.08), rgba(51,51,255,0.06));
    color:#ffd7ff;
    padding:8px 12px;
    border-radius:999px;
    font-weight:700;
    font-size:13px;
  }

  .cred-area{
    background:linear-gradient(180deg,#0f0f16, #0b0b12);
    border-radius:12px;
    padding:14px;
    border:1px solid rgba(255,0,204,0.06);
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .cred-label{ font-size:13px; color:#ffb7f0; font-weight:700; }
  .cred-data{
    font-size:16px;
    font-weight:800;
    word-break:break-all;
    color:#ffffff;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
    padding:10px;
    border-radius:8px;
  }

  .buttons-row{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap }
  .btn{
    padding:10px 18px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    font-weight:800;
    font-size:14px;
  }
  .btn-logout{
    background: linear-gradient(90deg,var(--pink),var(--blue));
    color:#fff;
  }
  .btn-renew{
    background:transparent;
    color:var(--pink);
    border:1px solid rgba(255,0,204,0.12);
  }
  .cred-copy-btn{
    background:linear-gradient(90deg,var(--pink),var(--blue));
    color:#fff;
    border:none;
    padding:8px 14px;
    border-radius:999px;
    font-weight:700;
    cursor:pointer;
  }

  .right{ display:flex; flex-direction:column; gap:14px; }
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    padding:16px;
    border-radius:14px;
  }
  .panel h4{ margin:0 0 8px 0; font-size:15px; color:#ffd6f7; font-weight:800 }
  .sub-item{
    padding:10px;
    border-radius:10px;
    background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    margin-bottom:8px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    cursor:pointer;
  }
  .expired-text{ color:#ff6b6b; font-weight:900 }
  #warning-text{ color:orange; font-weight:800 }

  #adminPopup{
    display:none;
    position:fixed;
    inset:0;
    align-items:center;
    justify-content:center;
    z-index:9999;
    background: rgba(0,0,0,0.55);
  }
  #adminPopupInner{
    width: min(420px,92vw);
    background: linear-gradient(180deg,#121216,#0b0b0d);
    border-radius:16px;
    padding:18px;
  }
  #adminPopupInner h3{ color:#ffb7f0; margin:0 0 8px 0; font-size:18px; }
  #adminPopupInner p{ color:var(--muted); margin:0 0 12px 0; }

  #copyToast{
    position:fixed;
    right:24px;
    bottom:24px;
    min-width:260px;
    border-radius:12px;
    padding:14px 16px;
    display:flex;
    gap:12px;
    align-items:center;
    transform:translateY(10px) scale(.98);
    opacity:0;
    pointer-events:none;
    transition:transform .25s ease, opacity .25s ease;
    z-index:10000;
  }
  #copyToast.show{
    transform:translateY(0) scale(1);
    opacity:1;
  }
  #copyToast .icon{
    width:44px;height:44px;border-radius:10px;
    background:linear-gradient(90deg,var(--pink),var(--blue));
    display:flex;align-items:center;justify-content:center;font-weight:900;
  }
  #copyToast .body{ display:flex;flex-direction:column; }
  #copyToast .body .title{ font-weight:900; font-size:15px; color:#fff; }
  #copyToast .body .value{ font-weight:900; font-size:14px; color:#fff; }

  @media (max-width:920px){
    .container{ grid-template-columns:1fr; padding:8px }
    .right{ order:2 }
    .left{ order:1 }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="left">
      <div>
        <div class="main-title">VIP DASHBOARD</div>
        <div class="subtitle">Welcome to Unknown Gamer — premium access panel</div>
      </div>

      <div class="vip-card" id="vipCard">
        <div class="card-row">
          <div>
            <div class="info-line" id="vip-name">Loading name...</div>
            <div class="muted-small" id="vip-type">Loading subscription type...</div>
          </div>
          <div class="vip-meta">
            <div class="pill" id="vip-expiry">Loading expiry...</div>
            <div class="pill" id="vip-days-left">--</div>
          </div>
        </div>

        <div id="warning-text" style="display:none;">⚠️ VIP is expiring soon!</div>

        <div class="section-title" style="margin-top:6px; font-weight:900; color:#ffd7ff">Your VIP Credentials</div>

        <div class="cred-area" id="credential-area">
          <div>
            <div class="cred-label">EMAIL</div>
            <div class="cred-data" id="fs-email">Loading...</div>
            <div style="margin-top:8px; display:flex; gap:8px;">
              <button class="cred-copy-btn" onclick="copyCredential('fs-email')">Copy Email</button>
              <button class="btn btn-renew" onclick="openProfile()">View Profile</button>
            </div>
          </div>

          <div style="margin-top:10px;">
            <div class="cred-label">PASSWORD</div>
            <div class="cred-data" id="fs-password">Loading...</div>
            <div style="margin-top:8px;">
              <button class="cred-copy-btn" onclick="copyCredential('fs-password')">Copy Password</button>
            </div>
          </div>

          <div class="buttons-row" style="margin-top:6px;">
            <button id="renew-btn" class="btn btn-renew" style="display:none" onclick="window.location.href='buygg.html'">Renew Now</button>
            <button id="logout-btn" class="btn btn-logout">Logout</button>
          </div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="panel">
        <h4>Subscription Status</h4>
        <div class="sub-item">
          <div>
            <div style="font-weight:800" id="status-main">Loading...</div>
            <div class="muted-small" id="status-sub">—</div>
          </div>
          <div class="pill" id="status-pill">—</div>
        </div>

        <h4 style="margin-top:12px">Available Plans</h4>
        <div class="sub-item">1 Month •</div>
        <div class="sub-item">3 Month • Popular</div>
        <div class="sub-item">12 Month • Best Value</div>
      </div>

      <div class="panel">
        <h4>Admin Help</h4>
        <p class="muted-small">If your VIP is inactive, ask admin to activate it. Admin will need the email send your Email To admin.</p>
        <button class="btn" style="background:linear-gradient(90deg,var(--pink),var(--blue)); color:white;" onclick="showAdminDialog(getCurrentEmail())">Ask Admin (Copy Email)</button>
      </div>
    </div>
  </div>

  <div id="adminPopup">
    <div id="adminPopupInner">
      <h3>VIP IS NOT ACTIVATED!</h3>
      <p>ASK ADMIN TO ACTIVATE YOUR ACCOUNT BY GIVING YOU ID</p>
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
        <div class="muted-small" style="font-weight:800" id="popupUserEmail">loading@unknown</div>
        <button class="btn" onclick="copyEmailPopup()">Copy Email</button>
        <button class="btn" onclick="document.getElementById('adminPopup').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <div id="copyToast" style="background:rgba(30,30,40,0.95); border:1px solid rgba(255,0,204,0.2);">
    <div class="icon">✓</div>
    <div class="body">
      <div class="title" id="toast-title">Copied</div>
      <div class="value" id="toast-value">value@example.com</div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ---------- Firebase init ----------
    const firebaseConfig = {
      apiKey: "AIzaSyA7oSJNvZxv2aBYNUGfj4UWJdm6yIoUwC8",
      authDomain: "vip-membership-b131a.firebaseapp.com",
      projectId: "vip-membership-b131a",
      storageBucket: "vip-membership-b131a.appspot.com",
      messagingSenderId: "1086103978236",
      appId: "1:1086103978236:web:b106e8d9afdc3d36925779"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ---------- Toast helpers ----------
    const toast = document.getElementById('copyToast');
    const toastTitle = document.getElementById('toast-title');
    const toastValue = document.getElementById('toast-value');
    let toastTimer = null;

    function showToast(title, value){
      toastTitle.textContent = title;
      toastValue.textContent = value;
      toast.classList.add('show');
      if(toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> { toast.classList.remove('show'); }, 3000);
    }
    function copyToClipboard(text, label){
      if(navigator.clipboard){
        navigator.clipboard.writeText(text).then(() => {
          showToast(`${label} copied!`, text);
        }).catch(()=>{ /* ignore */ });
      }
    }
    function copyCredential(id){
      const el = document.getElementById(id);
      if(!el) return;
      copyToClipboard(el.textContent.trim(), id.includes('email') ? 'Email' : 'Password');
    }
    function copyEmailPopup(){
      const email = document.getElementById('popupUserEmail').textContent.trim();
      copyToClipboard(email, 'Admin Email');
    }
    function showAdminDialog(email){
      document.getElementById('popupUserEmail').textContent = email || '—';
      document.getElementById('adminPopup').style.display = 'flex';
    }
    function getCurrentEmail(){
      return auth.currentUser ? auth.currentUser.email : 'not-signed-in';
    }
    function openProfile(){ alert('Open profile action'); }

    // ---------- Logout ----------
    document.getElementById('logout-btn').addEventListener('click', ()=>{
      auth.signOut().then(()=> window.location.href = 'viplogin.html');
    });

    // ---------- Main auth + Firestore logic (single listener, cleaned) ----------
    auth.onAuthStateChanged(async user => {
      if(!user){
        return window.location.replace('viplogin.html');
      }

      try {
        // Fetch user record
        const userDocRef = db.collection("UNKNOWN").doc(user.email.toLowerCase());
        const userDoc = await userDocRef.get();

        if(!userDoc.exists){
          // No VIP record -> lock credentials and show admin popup
          lockCredentials();
          showAdminDialog(user.email);
          paintStatus({
            name: user.displayName || 'User',
            typeRaw: 'Not VIP',
            expiryText: '—',
            daysLeft: null,
            expired: true
          });
          return;
        }

        const data = userDoc.data();
        const subscriptionTypeRaw = (data.subscriptionType || 'Not VIP').trim();
        const subscriptionType = subscriptionTypeRaw.toLowerCase();

        // Expiry compute
        let expired = false, showRenew = false, expiryText='—', daysLeft=null, expiryDate=null;
        if(data.subscriptionExpiry && typeof data.subscriptionExpiry.toDate==='function'){
          expiryDate = data.subscriptionExpiry.toDate();
          expiryText = `Expiry: ${expiryDate.toLocaleDateString()}`;
          daysLeft = Math.ceil((expiryDate - new Date()) / (1000*60*60*24));
          if(daysLeft <= 0){ expired=true; showRenew=true; }
        }

        // Update dashboard header
        paintStatus({
          name: data.HI || user.displayName || 'User',
          typeRaw: subscriptionTypeRaw,
          expiryText,
          daysLeft,
          expired
        });

        // Visual notice
        updateVisuals({ expired, daysLeft });

        // Credentials access control
        if(subscriptionType === 'not vip' || expired){
          lockCredentials();
          if(subscriptionType === 'not vip'){
            showAdminDialog(user.email);
          }
        } else {
          unlockCredentials();
          // Decide which credential doc to read (1month..12month)
          let credDocName = '';
          for(let m=1; m<=12; m++){
            if(subscriptionType.includes(m + ' month')){ credDocName = m + 'month'; break; }
          }
          if(subscriptionType.includes('monthly')) credDocName = '1month';
          // (Optional) handle '1 year' / '12 month'
          if(subscriptionType.includes('1 year') || subscriptionType.includes('12 month')) credDocName = '12month';

          if(credDocName){
            const credDoc = await db.collection("UNKNOWN").doc(credDocName).get();
            document.getElementById('fs-email').textContent = credDoc.exists ? (credDoc.data().EMAIL || 'N/A') : 'No data';
            document.getElementById('fs-password').textContent = credDoc.exists ? (credDoc.data().PASSWORD || 'N/A') : 'No data';
          } else {
            document.getElementById('fs-email').textContent = 'N/A';
            document.getElementById('fs-password').textContent = 'N/A';
          }
        }

        // Plans clickable if expired
        if(expired){
          document.querySelectorAll('.sub-item').forEach(item=>{
            item.onclick = ()=>{ window.location.href='buygg.html'; }
          });
          document.getElementById('renew-btn').style.display = 'inline-block';
        } else {
          document.querySelectorAll('.sub-item').forEach(item=>{
            item.onclick = null;
          });
          document.getElementById('renew-btn').style.display = 'none';
        }

      } catch (err) {
        // In case of error, keep user on page but lock credentials
        lockCredentials();
        console.error(err);
      }
    });

    // ---------- Helpers ----------
    function paintStatus({ name, typeRaw, expiryText, daysLeft, expired }){
      document.getElementById('vip-name').textContent = `Hi! ${name}`;
      document.getElementById('vip-type').textContent = typeRaw;
      document.getElementById('vip-expiry').textContent = expiryText;
      document.getElementById('vip-days-left').textContent = expired
        ? 'Expired'
        : (Number.isFinite(daysLeft) ? `${daysLeft} days left` : '--');

      document.getElementById('status-main').textContent = typeRaw;
      document.getElementById('status-sub').textContent = expiryText;

      const pill = document.getElementById('status-pill');
      if(expired){
        pill.textContent = 'INACTIVE';
      } else {
        pill.textContent = 'ACTIVE';
      }
    }

    function updateVisuals({ expired, daysLeft }){
      const card = document.getElementById('vipCard');
      const warn = document.getElementById('warning-text');

      if(expired){
        card.classList.remove('active');
        warn.style.display = 'none';
      } else {
        card.classList.add('active');
        if(Number.isFinite(daysLeft) && daysLeft <= 3){
          warn.style.display = 'block';
        } else {
          warn.style.display = 'none';
        }
      }
    }

    function lockCredentials(){
      document.getElementById('fs-email').textContent = 'Upgrade to view';
      document.getElementById('fs-password').textContent = 'Upgrade to view';
      const area = document.getElementById('credential-area');
      area.style.opacity = '0.6';
      area.style.pointerEvents = 'none';
    }

    function unlockCredentials(){
      const area = document.getElementById('credential-area');
      area.style.opacity = '1';
      area.style.pointerEvents = 'auto';
    }
  </script>
</body>
</html>
